<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product - RustPress Enterprise</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .product-gallery-thumb { transition: all 0.2s; }
        .product-gallery-thumb.active { border-color: #3b82f6; opacity: 1; }
        .product-gallery-thumb:not(.active) { opacity: 0.6; }
        .product-gallery-thumb:hover { opacity: 1; }
        .zoom-lens { position: absolute; border: 1px solid #3b82f6; background-color: rgba(59, 130, 246, 0.1); }
        .zoom-result { position: absolute; border: 1px solid #e5e7eb; background-repeat: no-repeat; }
        .quantity-input::-webkit-inner-spin-button,
        .quantity-input::-webkit-outer-spin-button { -webkit-appearance: none; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .rating-star { color: #fbbf24; }
        .rating-star.empty { color: #d1d5db; }
        .variant-option { transition: all 0.2s; }
        .variant-option.selected { border-color: #3b82f6; background-color: rgba(59, 130, 246, 0.1); }
        .sticky-add-to-cart { transform: translateY(100%); transition: transform 0.3s; }
        .sticky-add-to-cart.visible { transform: translateY(0); }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">
    <!-- Header -->
    <header class="bg-white shadow-sm sticky top-0 z-40">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex items-center justify-between h-16">
                <a href="/" class="flex items-center gap-2">
                    <img id="site-logo" src="/logo.png" alt="Logo" class="h-8">
                    <span id="site-name" class="text-xl font-bold text-gray-900">RustPress</span>
                </a>
                <nav id="header-nav" class="hidden md:flex items-center gap-6">
                    <!-- Navigation populated by JS -->
                </nav>
                <div class="flex items-center gap-4">
                    <button id="cart-btn" class="relative p-2 text-gray-600 hover:text-blue-600">
                        <i class="fas fa-shopping-cart text-xl"></i>
                        <span id="cart-count" class="absolute -top-1 -right-1 bg-blue-600 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span>
                    </button>
                    <button id="wishlist-btn" class="p-2 text-gray-600 hover:text-red-500">
                        <i class="fas fa-heart text-xl"></i>
                    </button>
                    <button id="user-btn" class="p-2 text-gray-600 hover:text-blue-600">
                        <i class="fas fa-user text-xl"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Breadcrumbs -->
    <nav class="bg-white border-b" id="breadcrumbs">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
            <ol class="flex items-center gap-2 text-sm">
                <li><a href="/" class="text-gray-500 hover:text-blue-600">Home</a></li>
                <li class="text-gray-400">/</li>
                <li><a href="/products" class="text-gray-500 hover:text-blue-600">Products</a></li>
                <li class="text-gray-400">/</li>
                <li id="breadcrumb-category"><a href="#" class="text-gray-500 hover:text-blue-600">Category</a></li>
                <li class="text-gray-400">/</li>
                <li id="breadcrumb-product" class="text-gray-900 font-medium">Product Name</li>
            </ol>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
            <!-- Product Gallery -->
            <div class="space-y-4">
                <!-- Main Image -->
                <div class="relative aspect-square bg-white rounded-xl overflow-hidden border" id="main-image-container">
                    <img id="main-product-image" src="https://picsum.photos/seed/product/800/800" alt="Product" class="w-full h-full object-contain">
                    <div class="absolute top-4 left-4 flex flex-col gap-2">
                        <span id="sale-badge" class="hidden bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-full">SALE</span>
                        <span id="new-badge" class="hidden bg-green-500 text-white text-xs font-bold px-3 py-1 rounded-full">NEW</span>
                    </div>
                    <button class="absolute top-4 right-4 p-2 bg-white/80 hover:bg-white rounded-full shadow" id="zoom-btn">
                        <i class="fas fa-search-plus text-gray-600"></i>
                    </button>
                </div>
                <!-- Thumbnails -->
                <div class="flex gap-3 overflow-x-auto pb-2" id="gallery-thumbnails">
                    <!-- Thumbnails populated by JS -->
                </div>
            </div>

            <!-- Product Info -->
            <div class="space-y-6">
                <!-- Title & Rating -->
                <div>
                    <div class="flex items-center gap-2 text-sm text-gray-500 mb-2">
                        <a href="#" id="product-brand" class="hover:text-blue-600">Brand Name</a>
                        <span>|</span>
                        <span id="product-sku">SKU: PRD-001</span>
                    </div>
                    <h1 id="product-title" class="text-3xl font-bold text-gray-900 mb-3">Product Name</h1>
                    <div class="flex items-center gap-4">
                        <div id="product-rating" class="flex items-center gap-1">
                            <!-- Stars populated by JS -->
                        </div>
                        <a href="#reviews" class="text-sm text-blue-600 hover:underline" id="reviews-count">(24 reviews)</a>
                        <span class="text-gray-300">|</span>
                        <span id="stock-status" class="text-sm text-green-600 font-medium">
                            <i class="fas fa-check-circle mr-1"></i>In Stock
                        </span>
                    </div>
                </div>

                <!-- Price -->
                <div class="flex items-baseline gap-3">
                    <span id="product-price" class="text-4xl font-bold text-gray-900">$99.99</span>
                    <span id="product-original-price" class="hidden text-xl text-gray-400 line-through">$149.99</span>
                    <span id="discount-badge" class="hidden bg-red-100 text-red-600 text-sm font-medium px-2 py-1 rounded">Save 33%</span>
                </div>

                <!-- Short Description -->
                <p id="product-short-description" class="text-gray-600 leading-relaxed">
                    Product short description goes here. This is a brief overview of the product's main features and benefits.
                </p>

                <!-- Variants -->
                <div id="variants-container" class="space-y-4">
                    <!-- Color Variant -->
                    <div class="variant-group" id="color-variants">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Color: <span id="selected-color" class="font-normal text-gray-500">Black</span></label>
                        <div class="flex gap-2" id="color-options">
                            <!-- Color options populated by JS -->
                        </div>
                    </div>
                    <!-- Size Variant -->
                    <div class="variant-group" id="size-variants">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Size: <span id="selected-size" class="font-normal text-gray-500">M</span></label>
                        <div class="flex gap-2" id="size-options">
                            <!-- Size options populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- Quantity & Add to Cart -->
                <div class="flex items-center gap-4">
                    <div class="flex items-center border rounded-lg">
                        <button id="qty-minus" class="px-4 py-3 text-gray-600 hover:text-blue-600 hover:bg-gray-50">
                            <i class="fas fa-minus"></i>
                        </button>
                        <input type="number" id="quantity" value="1" min="1" max="99" class="quantity-input w-16 text-center border-0 focus:ring-0 text-lg font-medium">
                        <button id="qty-plus" class="px-4 py-3 text-gray-600 hover:text-blue-600 hover:bg-gray-50">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                    <button id="add-to-cart-btn" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-lg transition flex items-center justify-center gap-2">
                        <i class="fas fa-shopping-cart"></i>
                        Add to Cart
                    </button>
                    <button id="add-to-wishlist-btn" class="p-3 border border-gray-300 rounded-lg hover:border-red-500 hover:text-red-500 transition">
                        <i class="far fa-heart text-xl"></i>
                    </button>
                </div>

                <!-- Buy Now -->
                <button id="buy-now-btn" class="w-full bg-gray-900 hover:bg-gray-800 text-white font-semibold py-3 px-8 rounded-lg transition">
                    Buy Now
                </button>

                <!-- Product Meta -->
                <div class="border-t pt-6 space-y-3 text-sm">
                    <div class="flex items-start gap-2">
                        <i class="fas fa-truck text-blue-600 w-5 mt-0.5"></i>
                        <div>
                            <span class="font-medium">Free Shipping</span>
                            <span class="text-gray-500">on orders over $50</span>
                        </div>
                    </div>
                    <div class="flex items-start gap-2">
                        <i class="fas fa-undo text-blue-600 w-5 mt-0.5"></i>
                        <div>
                            <span class="font-medium">30-Day Returns</span>
                            <span class="text-gray-500">hassle-free returns</span>
                        </div>
                    </div>
                    <div class="flex items-start gap-2">
                        <i class="fas fa-shield-alt text-blue-600 w-5 mt-0.5"></i>
                        <div>
                            <span class="font-medium">2-Year Warranty</span>
                            <span class="text-gray-500">manufacturer warranty included</span>
                        </div>
                    </div>
                </div>

                <!-- Share -->
                <div class="flex items-center gap-4 pt-4 border-t">
                    <span class="text-sm font-medium text-gray-700">Share:</span>
                    <div class="flex gap-2">
                        <button class="share-btn p-2 text-gray-400 hover:text-blue-500" data-platform="twitter" title="Share on Twitter">
                            <i class="fab fa-twitter text-lg"></i>
                        </button>
                        <button class="share-btn p-2 text-gray-400 hover:text-blue-600" data-platform="facebook" title="Share on Facebook">
                            <i class="fab fa-facebook text-lg"></i>
                        </button>
                        <button class="share-btn p-2 text-gray-400 hover:text-pink-500" data-platform="pinterest" title="Pin on Pinterest">
                            <i class="fab fa-pinterest text-lg"></i>
                        </button>
                        <button class="share-btn p-2 text-gray-400 hover:text-green-500" data-platform="whatsapp" title="Share on WhatsApp">
                            <i class="fab fa-whatsapp text-lg"></i>
                        </button>
                        <button id="copy-link-btn" class="p-2 text-gray-400 hover:text-gray-700" title="Copy Link">
                            <i class="fas fa-link text-lg"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Product Tabs -->
        <div class="mt-16">
            <div class="border-b">
                <nav class="flex gap-8" id="product-tabs">
                    <button class="tab-btn px-1 py-4 text-sm font-medium border-b-2 border-blue-600 text-blue-600" data-tab="description">
                        Description
                    </button>
                    <button class="tab-btn px-1 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="specifications">
                        Specifications
                    </button>
                    <button class="tab-btn px-1 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="reviews">
                        Reviews <span id="tab-reviews-count">(24)</span>
                    </button>
                    <button class="tab-btn px-1 py-4 text-sm font-medium border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="shipping">
                        Shipping & Returns
                    </button>
                </nav>
            </div>

            <!-- Tab Contents -->
            <div class="py-8">
                <!-- Description Tab -->
                <div id="tab-description" class="tab-content active prose max-w-none">
                    <p id="product-description">
                        Full product description will be loaded here. This section contains detailed information about the product,
                        including features, benefits, usage instructions, and more.
                    </p>
                </div>

                <!-- Specifications Tab -->
                <div id="tab-specifications" class="tab-content">
                    <table class="w-full">
                        <tbody id="specifications-table">
                            <!-- Specifications populated by JS -->
                        </tbody>
                    </table>
                </div>

                <!-- Reviews Tab -->
                <div id="tab-reviews" class="tab-content">
                    <!-- Reviews Summary -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-8">
                        <div class="bg-gray-50 rounded-xl p-6 text-center">
                            <div id="average-rating" class="text-5xl font-bold text-gray-900 mb-2">4.5</div>
                            <div id="average-rating-stars" class="flex justify-center gap-1 mb-2">
                                <!-- Stars populated by JS -->
                            </div>
                            <div id="total-reviews-text" class="text-sm text-gray-500">Based on 24 reviews</div>
                        </div>
                        <div class="md:col-span-2 space-y-2" id="rating-breakdown">
                            <!-- Rating bars populated by JS -->
                        </div>
                    </div>

                    <!-- Write Review Button -->
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-lg font-semibold">Customer Reviews</h3>
                        <button id="write-review-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition">
                            Write a Review
                        </button>
                    </div>

                    <!-- Reviews List -->
                    <div id="reviews-list" class="space-y-6">
                        <!-- Reviews populated by JS -->
                    </div>

                    <!-- Load More Reviews -->
                    <div class="text-center mt-8">
                        <button id="load-more-reviews" class="text-blue-600 hover:text-blue-700 font-medium">
                            Load More Reviews
                        </button>
                    </div>
                </div>

                <!-- Shipping Tab -->
                <div id="tab-shipping" class="tab-content prose max-w-none">
                    <h3>Shipping Information</h3>
                    <ul>
                        <li><strong>Standard Shipping:</strong> 5-7 business days - $5.99</li>
                        <li><strong>Express Shipping:</strong> 2-3 business days - $12.99</li>
                        <li><strong>Free Shipping:</strong> On orders over $50</li>
                    </ul>
                    <h3>Return Policy</h3>
                    <p>We offer a 30-day return policy for all unused items in their original packaging. To initiate a return:</p>
                    <ol>
                        <li>Contact our customer service team</li>
                        <li>Receive your return authorization number</li>
                        <li>Ship the item back with the original packaging</li>
                        <li>Receive your refund within 5-7 business days</li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- Related Products -->
        <section class="mt-16">
            <div class="flex items-center justify-between mb-8">
                <h2 class="text-2xl font-bold text-gray-900">Related Products</h2>
                <a href="/products" class="text-blue-600 hover:text-blue-700 font-medium flex items-center gap-1">
                    View All <i class="fas fa-arrow-right text-sm"></i>
                </a>
            </div>
            <div id="related-products" class="grid grid-cols-2 md:grid-cols-4 gap-6">
                <!-- Related products populated by JS -->
            </div>
        </section>

        <!-- Recently Viewed -->
        <section class="mt-16">
            <h2 class="text-2xl font-bold text-gray-900 mb-8">Recently Viewed</h2>
            <div id="recently-viewed" class="grid grid-cols-2 md:grid-cols-6 gap-4">
                <!-- Recently viewed products populated by JS -->
            </div>
        </section>
    </main>

    <!-- Sticky Add to Cart Bar -->
    <div id="sticky-cart" class="sticky-add-to-cart fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <img id="sticky-product-image" src="https://picsum.photos/seed/product/100/100" alt="Product" class="w-12 h-12 object-cover rounded">
                    <div>
                        <h3 id="sticky-product-title" class="font-medium text-gray-900">Product Name</h3>
                        <span id="sticky-product-price" class="text-lg font-bold text-gray-900">$99.99</span>
                    </div>
                </div>
                <button id="sticky-add-to-cart" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-lg transition flex items-center gap-2">
                    <i class="fas fa-shopping-cart"></i>
                    Add to Cart
                </button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-white mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-semibold mb-4">Shop</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="/products" class="hover:text-white">All Products</a></li>
                        <li><a href="/categories" class="hover:text-white">Categories</a></li>
                        <li><a href="/deals" class="hover:text-white">Deals</a></li>
                        <li><a href="/new-arrivals" class="hover:text-white">New Arrivals</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Customer Service</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="/contact" class="hover:text-white">Contact Us</a></li>
                        <li><a href="/faq" class="hover:text-white">FAQ</a></li>
                        <li><a href="/shipping" class="hover:text-white">Shipping Info</a></li>
                        <li><a href="/returns" class="hover:text-white">Returns</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">About</h3>
                    <ul class="space-y-2 text-gray-400">
                        <li><a href="/about" class="hover:text-white">Our Story</a></li>
                        <li><a href="/blog" class="hover:text-white">Blog</a></li>
                        <li><a href="/careers" class="hover:text-white">Careers</a></li>
                        <li><a href="/press" class="hover:text-white">Press</a></li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-lg font-semibold mb-4">Connect</h3>
                    <div class="flex gap-4 mb-4">
                        <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-twitter text-xl"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-facebook text-xl"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-instagram text-xl"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white"><i class="fab fa-youtube text-xl"></i></a>
                    </div>
                    <p class="text-gray-400 text-sm">Subscribe to our newsletter for updates and exclusive offers.</p>
                </div>
            </div>
            <div class="border-t border-gray-800 mt-8 pt-8 flex flex-col md:flex-row justify-between items-center">
                <p class="text-gray-400 text-sm">Â© 2024 RustPress. All rights reserved.</p>
                <div class="flex gap-6 mt-4 md:mt-0 text-gray-400 text-sm">
                    <a href="/privacy" class="hover:text-white">Privacy Policy</a>
                    <a href="/terms" class="hover:text-white">Terms of Service</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- Product Data Script -->
    <script>
        document.addEventListener('rustpress:ready', function() {
            const RustPress = window.RustPress;
            if (!RustPress) return;

            // Get current product from URL or context
            const productSlug = window.location.pathname.split('/').pop();
            const product = RustPress.products?.find(p => p.slug === productSlug) || RustPress.products?.[0];

            if (!product) {
                console.error('Product not found');
                return;
            }

            // Populate site info
            const site = RustPress.site || {};
            document.getElementById('site-name').textContent = site.name || 'RustPress';
            if (site.logo) document.getElementById('site-logo').src = site.logo;

            // Populate header navigation
            const headerNav = document.getElementById('header-nav');
            const headerMenu = RustPress.helpers?.getMenu?.('header') || RustPress.menus?.header || [];
            headerNav.innerHTML = headerMenu.map(item => `
                <a href="${item.url}" class="text-gray-600 hover:text-blue-600 font-medium">${item.label}</a>
            `).join('');

            // Populate breadcrumbs
            if (product.category) {
                document.getElementById('breadcrumb-category').innerHTML = `
                    <a href="/products?category=${product.category.slug}" class="text-gray-500 hover:text-blue-600">${product.category.name}</a>
                `;
            }
            document.getElementById('breadcrumb-product').textContent = product.name;

            // Populate product info
            document.getElementById('product-title').textContent = product.name;
            document.getElementById('product-brand').textContent = product.brand || 'RustPress Store';
            document.getElementById('product-sku').textContent = `SKU: ${product.sku || product.id}`;
            document.getElementById('product-short-description').textContent = product.shortDescription || product.description?.substring(0, 200) + '...';
            document.getElementById('product-description').innerHTML = product.description || 'No description available.';

            // Populate price
            const price = product.salePrice || product.price;
            const originalPrice = product.salePrice ? product.price : null;
            const currency = product.currency || '$';

            document.getElementById('product-price').textContent = RustPress.helpers?.formatPrice?.(price, currency) || `${currency}${price}`;

            if (originalPrice && originalPrice > price) {
                document.getElementById('product-original-price').textContent = RustPress.helpers?.formatPrice?.(originalPrice, currency) || `${currency}${originalPrice}`;
                document.getElementById('product-original-price').classList.remove('hidden');
                document.getElementById('sale-badge').classList.remove('hidden');

                const discount = Math.round((1 - price / originalPrice) * 100);
                document.getElementById('discount-badge').textContent = `Save ${discount}%`;
                document.getElementById('discount-badge').classList.remove('hidden');
            }

            // Populate sticky cart
            document.getElementById('sticky-product-title').textContent = product.name;
            document.getElementById('sticky-product-price').textContent = RustPress.helpers?.formatPrice?.(price, currency) || `${currency}${price}`;

            // Check for new product (created within last 30 days)
            if (product.createdAt) {
                const thirtyDaysAgo = new Date();
                thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                if (new Date(product.createdAt) > thirtyDaysAgo) {
                    document.getElementById('new-badge').classList.remove('hidden');
                }
            }

            // Populate stock status
            const stockStatus = document.getElementById('stock-status');
            if (product.stock === 0 || product.inStock === false) {
                stockStatus.innerHTML = '<i class="fas fa-times-circle mr-1"></i>Out of Stock';
                stockStatus.className = 'text-sm text-red-600 font-medium';
                document.getElementById('add-to-cart-btn').disabled = true;
                document.getElementById('add-to-cart-btn').classList.add('opacity-50', 'cursor-not-allowed');
            } else if (product.stock && product.stock < 10) {
                stockStatus.innerHTML = `<i class="fas fa-exclamation-circle mr-1"></i>Only ${product.stock} left`;
                stockStatus.className = 'text-sm text-orange-600 font-medium';
            }

            // Populate rating
            const rating = product.rating || 4.5;
            const reviewCount = product.reviewCount || 24;
            const ratingContainer = document.getElementById('product-rating');
            ratingContainer.innerHTML = generateStars(rating);
            document.getElementById('reviews-count').textContent = `(${reviewCount} reviews)`;
            document.getElementById('tab-reviews-count').textContent = `(${reviewCount})`;

            // Populate gallery
            const images = product.images || [product.image || 'https://picsum.photos/seed/product/800/800'];
            const mainImage = document.getElementById('main-product-image');
            const stickyImage = document.getElementById('sticky-product-image');
            mainImage.src = images[0];
            stickyImage.src = images[0];

            const thumbnailsContainer = document.getElementById('gallery-thumbnails');
            thumbnailsContainer.innerHTML = images.map((img, index) => `
                <button class="product-gallery-thumb w-20 h-20 border-2 rounded-lg overflow-hidden ${index === 0 ? 'active border-blue-600' : 'border-gray-200'}" data-index="${index}">
                    <img src="${img}" alt="Thumbnail ${index + 1}" class="w-full h-full object-cover">
                </button>
            `).join('');

            // Gallery thumbnail click
            thumbnailsContainer.querySelectorAll('.product-gallery-thumb').forEach(thumb => {
                thumb.addEventListener('click', function() {
                    const index = parseInt(this.dataset.index);
                    mainImage.src = images[index];
                    thumbnailsContainer.querySelectorAll('.product-gallery-thumb').forEach(t => {
                        t.classList.remove('active', 'border-blue-600');
                        t.classList.add('border-gray-200');
                    });
                    this.classList.add('active', 'border-blue-600');
                    this.classList.remove('border-gray-200');
                });
            });

            // Populate variants
            if (product.variants) {
                // Color variants
                if (product.variants.colors) {
                    const colorOptions = document.getElementById('color-options');
                    colorOptions.innerHTML = product.variants.colors.map((color, index) => `
                        <button class="variant-option w-10 h-10 rounded-full border-2 ${index === 0 ? 'selected border-blue-600' : 'border-gray-200'}"
                                style="background-color: ${color.hex || color}"
                                data-value="${color.name || color}"
                                title="${color.name || color}">
                        </button>
                    `).join('');

                    colorOptions.querySelectorAll('.variant-option').forEach(btn => {
                        btn.addEventListener('click', function() {
                            colorOptions.querySelectorAll('.variant-option').forEach(b => b.classList.remove('selected', 'border-blue-600'));
                            this.classList.add('selected', 'border-blue-600');
                            document.getElementById('selected-color').textContent = this.dataset.value;
                        });
                    });
                } else {
                    document.getElementById('color-variants').style.display = 'none';
                }

                // Size variants
                if (product.variants.sizes) {
                    const sizeOptions = document.getElementById('size-options');
                    sizeOptions.innerHTML = product.variants.sizes.map((size, index) => `
                        <button class="variant-option px-4 py-2 border-2 rounded-lg font-medium ${index === 0 ? 'selected border-blue-600' : 'border-gray-200'}"
                                data-value="${size}">
                            ${size}
                        </button>
                    `).join('');

                    sizeOptions.querySelectorAll('.variant-option').forEach(btn => {
                        btn.addEventListener('click', function() {
                            sizeOptions.querySelectorAll('.variant-option').forEach(b => b.classList.remove('selected', 'border-blue-600'));
                            this.classList.add('selected', 'border-blue-600');
                            document.getElementById('selected-size').textContent = this.dataset.value;
                        });
                    });
                } else {
                    document.getElementById('size-variants').style.display = 'none';
                }
            } else {
                document.getElementById('variants-container').style.display = 'none';
            }

            // Populate specifications
            const specs = product.specifications || {
                'Brand': product.brand || 'RustPress Store',
                'SKU': product.sku || product.id,
                'Weight': product.weight || 'N/A',
                'Dimensions': product.dimensions || 'N/A',
                'Material': product.material || 'N/A'
            };
            const specsTable = document.getElementById('specifications-table');
            specsTable.innerHTML = Object.entries(specs).map(([key, value]) => `
                <tr class="border-b">
                    <td class="py-3 pr-4 font-medium text-gray-700 w-48">${key}</td>
                    <td class="py-3 text-gray-600">${value}</td>
                </tr>
            `).join('');

            // Populate reviews
            populateReviews(product.reviews || generateMockReviews());

            // Populate related products
            const relatedProducts = RustPress.products?.filter(p =>
                p.id !== product.id &&
                (p.category?.slug === product.category?.slug || p.category === product.category)
            ).slice(0, 4) || [];

            const relatedContainer = document.getElementById('related-products');
            relatedContainer.innerHTML = relatedProducts.map(p => createProductCard(p)).join('');

            // Quantity controls
            const quantityInput = document.getElementById('quantity');
            document.getElementById('qty-minus').addEventListener('click', () => {
                if (parseInt(quantityInput.value) > 1) {
                    quantityInput.value = parseInt(quantityInput.value) - 1;
                }
            });
            document.getElementById('qty-plus').addEventListener('click', () => {
                if (parseInt(quantityInput.value) < 99) {
                    quantityInput.value = parseInt(quantityInput.value) + 1;
                }
            });

            // Tab navigation
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabId = this.dataset.tab;

                    // Update button states
                    document.querySelectorAll('.tab-btn').forEach(b => {
                        b.classList.remove('border-blue-600', 'text-blue-600');
                        b.classList.add('border-transparent', 'text-gray-500');
                    });
                    this.classList.add('border-blue-600', 'text-blue-600');
                    this.classList.remove('border-transparent', 'text-gray-500');

                    // Show active tab content
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    document.getElementById('tab-' + tabId).classList.add('active');
                });
            });

            // Sticky cart visibility
            window.addEventListener('scroll', () => {
                const stickyCart = document.getElementById('sticky-cart');
                const addToCartBtn = document.getElementById('add-to-cart-btn');
                const rect = addToCartBtn.getBoundingClientRect();

                if (rect.bottom < 0) {
                    stickyCart.classList.add('visible');
                } else {
                    stickyCart.classList.remove('visible');
                }
            });

            // Share buttons
            document.querySelectorAll('.share-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const platform = this.dataset.platform;
                    const url = encodeURIComponent(window.location.href);
                    const title = encodeURIComponent(product.name);

                    const shareUrls = {
                        twitter: `https://twitter.com/intent/tweet?url=${url}&text=${title}`,
                        facebook: `https://www.facebook.com/sharer/sharer.php?u=${url}`,
                        pinterest: `https://pinterest.com/pin/create/button/?url=${url}&description=${title}`,
                        whatsapp: `https://wa.me/?text=${title}%20${url}`
                    };

                    if (shareUrls[platform]) {
                        window.open(shareUrls[platform], '_blank', 'width=600,height=400');
                    }
                });
            });

            document.getElementById('copy-link-btn').addEventListener('click', () => {
                navigator.clipboard.writeText(window.location.href).then(() => {
                    alert('Link copied to clipboard!');
                });
            });

            // Add to cart functionality
            document.getElementById('add-to-cart-btn').addEventListener('click', () => {
                const quantity = parseInt(quantityInput.value);
                alert(`Added ${quantity} x ${product.name} to cart!`);
                // In real implementation, this would dispatch to cart store
            });

            document.getElementById('sticky-add-to-cart').addEventListener('click', () => {
                const quantity = parseInt(quantityInput.value);
                alert(`Added ${quantity} x ${product.name} to cart!`);
            });

            // Wishlist functionality
            document.getElementById('add-to-wishlist-btn').addEventListener('click', function() {
                const icon = this.querySelector('i');
                if (icon.classList.contains('far')) {
                    icon.classList.remove('far');
                    icon.classList.add('fas', 'text-red-500');
                } else {
                    icon.classList.remove('fas', 'text-red-500');
                    icon.classList.add('far');
                }
            });
        });

        // Helper functions
        function generateStars(rating) {
            let stars = '';
            for (let i = 1; i <= 5; i++) {
                if (i <= rating) {
                    stars += '<i class="fas fa-star rating-star"></i>';
                } else if (i - 0.5 <= rating) {
                    stars += '<i class="fas fa-star-half-alt rating-star"></i>';
                } else {
                    stars += '<i class="far fa-star rating-star empty"></i>';
                }
            }
            return stars;
        }

        function createProductCard(product) {
            const price = product.salePrice || product.price;
            const currency = product.currency || '$';
            return `
                <a href="/products/${product.slug}" class="group">
                    <div class="aspect-square bg-gray-100 rounded-xl overflow-hidden mb-3">
                        <img src="${product.image || product.images?.[0] || 'https://picsum.photos/seed/' + product.id + '/400/400'}"
                             alt="${product.name}"
                             class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300">
                    </div>
                    <h3 class="font-medium text-gray-900 group-hover:text-blue-600 transition-colors truncate">${product.name}</h3>
                    <div class="flex items-center gap-1 my-1">
                        ${generateStars(product.rating || 4)}
                    </div>
                    <p class="font-bold text-gray-900">${currency}${price}</p>
                </a>
            `;
        }

        function populateReviews(reviews) {
            const reviewsList = document.getElementById('reviews-list');
            reviewsList.innerHTML = reviews.slice(0, 5).map(review => `
                <div class="border-b pb-6">
                    <div class="flex items-start justify-between mb-3">
                        <div>
                            <div class="flex items-center gap-2">
                                ${generateStars(review.rating)}
                                <span class="font-medium text-gray-900">${review.title || ''}</span>
                            </div>
                            <div class="flex items-center gap-2 mt-1 text-sm text-gray-500">
                                <span class="font-medium">${review.author}</span>
                                ${review.verified ? '<span class="text-green-600"><i class="fas fa-check-circle mr-1"></i>Verified Purchase</span>' : ''}
                            </div>
                        </div>
                        <span class="text-sm text-gray-400">${review.date}</span>
                    </div>
                    <p class="text-gray-600">${review.content}</p>
                    <div class="flex items-center gap-4 mt-3 text-sm">
                        <button class="text-gray-500 hover:text-blue-600">
                            <i class="far fa-thumbs-up mr-1"></i>Helpful (${review.helpful || 0})
                        </button>
                        <button class="text-gray-500 hover:text-red-500">
                            <i class="fas fa-flag mr-1"></i>Report
                        </button>
                    </div>
                </div>
            `).join('');

            // Rating breakdown
            const ratingBreakdown = document.getElementById('rating-breakdown');
            const totalReviews = reviews.length || 24;
            const breakdown = [5, 4, 3, 2, 1].map(star => {
                const count = reviews.filter(r => Math.floor(r.rating) === star).length || Math.floor(Math.random() * 10);
                const percentage = Math.round((count / totalReviews) * 100);
                return { star, count, percentage };
            });

            ratingBreakdown.innerHTML = breakdown.map(({ star, count, percentage }) => `
                <div class="flex items-center gap-3">
                    <span class="text-sm text-gray-600 w-8">${star} <i class="fas fa-star text-yellow-400 text-xs"></i></span>
                    <div class="flex-1 bg-gray-200 rounded-full h-2">
                        <div class="bg-yellow-400 rounded-full h-2" style="width: ${percentage}%"></div>
                    </div>
                    <span class="text-sm text-gray-500 w-8">${count}</span>
                </div>
            `).join('');
        }

        function generateMockReviews() {
            return [
                { rating: 5, title: 'Excellent Product!', author: 'John D.', verified: true, date: '2 weeks ago', content: 'This product exceeded my expectations. The quality is outstanding and it arrived quickly. Highly recommend!', helpful: 12 },
                { rating: 4, title: 'Great value', author: 'Sarah M.', verified: true, date: '1 month ago', content: 'Very good product for the price. Minor issues with packaging but the product itself is perfect.', helpful: 8 },
                { rating: 5, title: 'Perfect!', author: 'Mike R.', verified: false, date: '1 month ago', content: 'Exactly what I was looking for. Works great and looks even better than in the photos.', helpful: 5 },
                { rating: 3, title: 'Good but could be better', author: 'Emily T.', verified: true, date: '2 months ago', content: 'The product is decent but I expected more based on the description. Still usable and functional.', helpful: 3 },
                { rating: 5, title: 'Amazing quality', author: 'David L.', verified: true, date: '2 months ago', content: 'Superb quality and fast shipping. Will definitely buy again from this store.', helpful: 15 }
            ];
        }

        // Trigger rustpress:ready if RustPress data is already available
        if (window.RustPress) {
            document.dispatchEvent(new Event('rustpress:ready'));
        }
    </script>
</body>
</html>
