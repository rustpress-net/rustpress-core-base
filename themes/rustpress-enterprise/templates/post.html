<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{post.title}} - {{site.name}}</title>
  <meta name="description" content="{{post.excerpt}}">
  <meta name="author" content="{{post.author.name}}">
  <meta name="keywords" content="{{post.tags}}">

  <!-- Open Graph -->
  <meta property="og:title" content="{{post.title}}">
  <meta property="og:description" content="{{post.excerpt}}">
  <meta property="og:image" content="{{post.featuredImage}}">
  <meta property="og:type" content="article">
  <meta property="article:published_time" content="{{post.publishedAt}}">
  <meta property="article:author" content="{{post.author.name}}">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="{{post.title}}">
  <meta name="twitter:description" content="{{post.excerpt}}">
  <meta name="twitter:image" content="{{post.featuredImage}}">

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Syntax Highlighting -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">

  <style>
    :root {
      --primary: #3b82f6;
      --primary-dark: #2563eb;
    }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }
    .gradient-text {
      background: linear-gradient(135deg, var(--primary), #8b5cf6);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    /* Article Content Styles */
    .article-content {
      font-size: 1.125rem;
      line-height: 1.8;
      color: #374151;
    }
    .article-content h2 {
      font-size: 1.75rem;
      font-weight: 700;
      color: #111827;
      margin-top: 2.5rem;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #e5e7eb;
    }
    .article-content h3 {
      font-size: 1.375rem;
      font-weight: 600;
      color: #1f2937;
      margin-top: 2rem;
      margin-bottom: 0.75rem;
    }
    .article-content p {
      margin-bottom: 1.5rem;
    }
    .article-content a {
      color: var(--primary);
      text-decoration: underline;
      text-underline-offset: 2px;
    }
    .article-content a:hover {
      color: var(--primary-dark);
    }
    .article-content ul, .article-content ol {
      margin-bottom: 1.5rem;
      padding-left: 1.5rem;
    }
    .article-content li {
      margin-bottom: 0.5rem;
    }
    .article-content ul li {
      list-style-type: disc;
    }
    .article-content ol li {
      list-style-type: decimal;
    }
    .article-content blockquote {
      border-left: 4px solid var(--primary);
      padding: 1rem 1.5rem;
      margin: 1.5rem 0;
      background: #f3f4f6;
      border-radius: 0 0.5rem 0.5rem 0;
      font-style: italic;
      color: #4b5563;
    }
    .article-content pre {
      margin: 1.5rem 0;
      border-radius: 0.75rem;
      overflow-x: auto;
    }
    .article-content code {
      font-family: 'Fira Code', 'Monaco', monospace;
      font-size: 0.9em;
    }
    .article-content :not(pre) > code {
      background: #f3f4f6;
      padding: 0.2em 0.4em;
      border-radius: 0.25rem;
      color: #dc2626;
    }
    .article-content img {
      max-width: 100%;
      height: auto;
      border-radius: 0.75rem;
      margin: 1.5rem 0;
    }
    .article-content table {
      width: 100%;
      margin: 1.5rem 0;
      border-collapse: collapse;
    }
    .article-content th, .article-content td {
      padding: 0.75rem 1rem;
      border: 1px solid #e5e7eb;
      text-align: left;
    }
    .article-content th {
      background: #f9fafb;
      font-weight: 600;
    }
    /* Table of Contents */
    .toc-link {
      transition: all 0.2s;
    }
    .toc-link:hover {
      color: var(--primary);
      padding-left: 0.5rem;
    }
    .toc-link.active {
      color: var(--primary);
      font-weight: 600;
      border-left: 2px solid var(--primary);
      padding-left: 0.75rem;
      margin-left: -2px;
    }
  </style>
</head>
<body class="bg-gray-50">

  <!-- Header -->
  <header class="bg-white shadow-sm sticky top-0 z-50">
    <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex justify-between h-16 items-center">
        <a href="/" class="flex items-center gap-2">
          <span class="text-xl font-bold gradient-text">{{site.name}}</span>
        </a>
        <div class="hidden md:flex items-center gap-6" id="main-nav"></div>
        <div class="flex items-center gap-4">
          <button class="text-gray-600 hover:text-gray-900">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
          </button>
        </div>
      </div>
    </nav>
  </header>

  <!-- Breadcrumbs -->
  <div class="bg-gray-100 border-b">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-3">
      <nav class="flex items-center gap-2 text-sm" id="breadcrumbs">
        <!-- Will be populated by JavaScript -->
      </nav>
    </div>
  </div>

  <!-- Main Content -->
  <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="lg:grid lg:grid-cols-12 lg:gap-8">

      <!-- Article -->
      <article class="lg:col-span-8">
        <!-- Post Header -->
        <header class="mb-8" id="post-header">
          <!-- Will be populated by JavaScript -->
        </header>

        <!-- Featured Image -->
        <div class="mb-8 rounded-2xl overflow-hidden shadow-lg" id="featured-image">
          <!-- Will be populated by JavaScript -->
        </div>

        <!-- Article Content -->
        <div class="bg-white rounded-2xl shadow-sm p-8 lg:p-12">
          <div class="article-content" id="post-content">
            <!-- Will be populated by JavaScript -->
          </div>

          <!-- Tags -->
          <div class="mt-8 pt-8 border-t" id="post-tags">
            <!-- Will be populated by JavaScript -->
          </div>

          <!-- Share Buttons -->
          <div class="mt-8 pt-8 border-t">
            <h4 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-4">Share this article</h4>
            <div class="flex gap-3" id="share-buttons">
              <!-- Will be populated by JavaScript -->
            </div>
          </div>
        </div>

        <!-- Author Box -->
        <div class="mt-8 bg-white rounded-2xl shadow-sm p-8" id="author-box">
          <!-- Will be populated by JavaScript -->
        </div>

        <!-- Related Posts -->
        <div class="mt-8">
          <h3 class="text-xl font-bold text-gray-900 mb-6">Related Articles</h3>
          <div class="grid md:grid-cols-2 gap-6" id="related-posts">
            <!-- Will be populated by JavaScript -->
          </div>
        </div>

        <!-- Comments Section -->
        <div class="mt-8 bg-white rounded-2xl shadow-sm p-8" id="comments-section">
          <!-- Will be populated by JavaScript -->
        </div>
      </article>

      <!-- Sidebar -->
      <aside class="lg:col-span-4 mt-8 lg:mt-0">
        <div class="sticky top-24 space-y-6">

          <!-- Table of Contents -->
          <div class="bg-white rounded-xl shadow-sm p-6">
            <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-4">Table of Contents</h3>
            <nav class="space-y-2" id="table-of-contents">
              <!-- Will be populated by JavaScript -->
            </nav>
          </div>

          <!-- Author Card -->
          <div class="bg-white rounded-xl shadow-sm p-6" id="sidebar-author">
            <!-- Will be populated by JavaScript -->
          </div>

          <!-- Newsletter -->
          <div class="bg-gradient-to-br from-blue-600 to-purple-600 rounded-xl shadow-sm p-6 text-white">
            <h3 class="font-semibold mb-2">Get more articles like this</h3>
            <p class="text-sm text-blue-100 mb-4">Subscribe to our newsletter for weekly updates.</p>
            <form class="space-y-3">
              <input type="email" placeholder="Your email" class="w-full px-4 py-2 rounded-lg text-gray-900 text-sm">
              <button type="submit" class="w-full px-4 py-2 bg-white text-blue-600 font-medium rounded-lg hover:bg-gray-100 transition text-sm">
                Subscribe
              </button>
            </form>
          </div>

          <!-- Popular Posts -->
          <div class="bg-white rounded-xl shadow-sm p-6">
            <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-4">Popular Posts</h3>
            <div class="space-y-4" id="popular-posts">
              <!-- Will be populated by JavaScript -->
            </div>
          </div>

          <!-- Categories -->
          <div class="bg-white rounded-xl shadow-sm p-6">
            <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-4">Categories</h3>
            <div class="space-y-2" id="sidebar-categories">
              <!-- Will be populated by JavaScript -->
            </div>
          </div>

        </div>
      </aside>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-900 text-gray-400 py-12 mt-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex flex-col md:flex-row justify-between items-center gap-4">
        <p>{{site.copyright}}</p>
        <div class="flex gap-6" id="footer-nav"></div>
      </div>
    </div>
  </footer>

  <!-- Prism.js for syntax highlighting -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-javascript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-typescript.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-rust.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-css.min.js"></script>

  <script>
    // Get post slug from URL (e.g., /post/my-post-slug)
    const pathParts = window.location.pathname.split('/');
    const postSlug = pathParts[pathParts.length - 1] || pathParts[pathParts.length - 2];

    // Wait for RustPress data
    window.addEventListener('rustpress:ready', function(e) {
      const data = e.detail;

      // Find the current post
      const post = data.posts.find(p => p.slug === postSlug) || data.posts[0];

      if (!post) {
        document.getElementById('post-content').innerHTML = '<p class="text-red-600">Post not found</p>';
        return;
      }

      // Render all sections
      renderNavigation(data.menus);
      renderBreadcrumbs(post);
      renderPostHeader(post);
      renderFeaturedImage(post);
      renderPostContent(post);
      renderTags(post);
      renderShareButtons(post);
      renderAuthorBox(post.author);
      renderRelatedPosts(data.posts, post);
      renderComments(data.comments || []);
      renderTableOfContents(post);
      renderSidebarAuthor(post.author);
      renderPopularPosts(data.popularPosts || data.posts.slice(0, 5));
      renderSidebarCategories(data.categories);
      renderFooter(data.menus);

      // Highlight code blocks
      Prism.highlightAll();

      // Setup scroll spy for ToC
      setupScrollSpy();
    });

    if (window.RustPress) {
      window.dispatchEvent(new CustomEvent('rustpress:ready', { detail: window.RustPress }));
    }

    function renderNavigation(menus) {
      const headerMenu = menus.find(m => m.location === 'header');
      if (!headerMenu) return;
      document.getElementById('main-nav').innerHTML = headerMenu.items.map(item => `
        <a href="${item.url}" class="text-gray-700 hover:text-blue-600 font-medium transition">${item.label}</a>
      `).join('');
    }

    function renderBreadcrumbs(post) {
      document.getElementById('breadcrumbs').innerHTML = `
        <a href="/" class="text-gray-500 hover:text-blue-600">Home</a>
        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
        <a href="/blog" class="text-gray-500 hover:text-blue-600">Blog</a>
        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
        <a href="${RustPress.helpers.getCategoryUrl(post.category)}" class="text-gray-500 hover:text-blue-600">${post.category?.name || 'Uncategorized'}</a>
        <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
        </svg>
        <span class="text-gray-900 font-medium truncate max-w-xs">${post.title}</span>
      `;
    }

    function renderPostHeader(post) {
      document.getElementById('post-header').innerHTML = `
        <div class="flex items-center gap-3 mb-4">
          <a href="${RustPress.helpers.getCategoryUrl(post.category)}" class="px-3 py-1 bg-blue-100 text-blue-600 text-sm font-medium rounded-full hover:bg-blue-200 transition">
            ${post.category?.name || 'Uncategorized'}
          </a>
          <span class="text-gray-500 text-sm">${RustPress.helpers.formatDate(post.publishedAt)}</span>
          <span class="text-gray-400">â€¢</span>
          <span class="text-gray-500 text-sm">${post.readingTime} min read</span>
        </div>
        <h1 class="text-3xl sm:text-4xl lg:text-5xl font-bold text-gray-900 mb-6 leading-tight">
          ${post.title}
        </h1>
        <p class="text-xl text-gray-600 mb-6">${post.excerpt}</p>
        <div class="flex items-center gap-4">
          <img src="${post.author?.avatar}" alt="${post.author?.name}" class="w-12 h-12 rounded-full">
          <div>
            <a href="${RustPress.helpers.getAuthorUrl(post.author)}" class="font-semibold text-gray-900 hover:text-blue-600 transition">
              ${post.author?.name}
            </a>
            <p class="text-sm text-gray-500">${post.author?.bio ? RustPress.helpers.truncate(post.author.bio, 60) : ''}</p>
          </div>
        </div>
      `;
    }

    function renderFeaturedImage(post) {
      document.getElementById('featured-image').innerHTML = `
        <img src="${post.featuredImage}" alt="${post.title}" class="w-full h-auto">
      `;
    }

    function renderPostContent(post) {
      document.getElementById('post-content').innerHTML = post.html || post.content;
    }

    function renderTags(post) {
      if (!post.tags?.length) return;
      document.getElementById('post-tags').innerHTML = `
        <h4 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-3">Tags</h4>
        <div class="flex flex-wrap gap-2">
          ${post.tags.map(tag => `
            <a href="${RustPress.helpers.getTagUrl(tag)}" class="px-3 py-1 bg-gray-100 text-gray-700 text-sm rounded-full hover:bg-gray-200 transition">
              #${tag.name}
            </a>
          `).join('')}
        </div>
      `;
    }

    function renderShareButtons(post) {
      const url = encodeURIComponent(window.location.href);
      const title = encodeURIComponent(post.title);
      document.getElementById('share-buttons').innerHTML = `
        <a href="https://twitter.com/intent/tweet?url=${url}&text=${title}" target="_blank" rel="noopener"
           class="flex items-center gap-2 px-4 py-2 bg-[#1DA1F2] text-white rounded-lg hover:bg-[#1a8cd8] transition">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg>
          Twitter
        </a>
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=${url}&title=${title}" target="_blank" rel="noopener"
           class="flex items-center gap-2 px-4 py-2 bg-[#0A66C2] text-white rounded-lg hover:bg-[#094d92] transition">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
          LinkedIn
        </a>
        <a href="https://www.facebook.com/sharer/sharer.php?u=${url}" target="_blank" rel="noopener"
           class="flex items-center gap-2 px-4 py-2 bg-[#1877F2] text-white rounded-lg hover:bg-[#1464d1] transition">
          <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24"><path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/></svg>
          Facebook
        </a>
        <button onclick="navigator.clipboard.writeText(window.location.href); this.innerHTML='Copied!'; setTimeout(() => this.innerHTML='Copy Link', 2000)"
                class="flex items-center gap-2 px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/></svg>
          Copy Link
        </button>
      `;
    }

    function renderAuthorBox(author) {
      document.getElementById('author-box').innerHTML = `
        <div class="flex items-start gap-6">
          <img src="${author?.avatar}" alt="${author?.name}" class="w-20 h-20 rounded-full flex-shrink-0">
          <div>
            <h3 class="text-lg font-semibold text-gray-900 mb-1">
              <a href="${RustPress.helpers.getAuthorUrl(author)}" class="hover:text-blue-600 transition">
                ${author?.name}
              </a>
            </h3>
            <p class="text-sm text-blue-600 mb-3">${author?.role || 'Author'}</p>
            <p class="text-gray-600 mb-4">${author?.bio || ''}</p>
            <div class="flex gap-3">
              ${author?.social?.twitter ? `
                <a href="https://twitter.com/${author.social.twitter}" target="_blank" rel="noopener" class="text-gray-400 hover:text-blue-500 transition">
                  <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg>
                </a>
              ` : ''}
              ${author?.social?.website ? `
                <a href="${author.social.website}" target="_blank" rel="noopener" class="text-gray-400 hover:text-blue-500 transition">
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9c1.657 0 3-4.03 3-9s-1.343-9-3-9m0 18c-1.657 0-3-4.03-3-9s1.343-9 3-9m-9 9a9 9 0 019-9"/></svg>
                </a>
              ` : ''}
            </div>
          </div>
        </div>
      `;
    }

    function renderRelatedPosts(posts, currentPost) {
      const related = posts
        .filter(p => p.id !== currentPost.id && p.category?.slug === currentPost.category?.slug)
        .slice(0, 2);

      if (!related.length) {
        document.getElementById('related-posts').innerHTML = '<p class="text-gray-500 col-span-2">No related posts found</p>';
        return;
      }

      document.getElementById('related-posts').innerHTML = related.map(post => `
        <article class="bg-white rounded-xl shadow-sm overflow-hidden hover:shadow-md transition">
          <a href="${RustPress.helpers.getPostUrl(post)}">
            <img src="${post.featuredImage}" alt="${post.title}" class="w-full h-40 object-cover">
          </a>
          <div class="p-5">
            <span class="text-xs font-medium text-blue-600">${post.category?.name}</span>
            <h4 class="font-semibold text-gray-900 mt-1 line-clamp-2">
              <a href="${RustPress.helpers.getPostUrl(post)}" class="hover:text-blue-600 transition">${post.title}</a>
            </h4>
            <p class="text-sm text-gray-500 mt-2">${RustPress.helpers.formatDate(post.publishedAt, 'short')}</p>
          </div>
        </article>
      `).join('');
    }

    function renderComments(comments) {
      const container = document.getElementById('comments-section');
      container.innerHTML = `
        <h3 class="text-xl font-bold text-gray-900 mb-6">Comments (${comments.length})</h3>

        <!-- Comment Form -->
        <form class="mb-8 p-6 bg-gray-50 rounded-xl">
          <h4 class="font-semibold text-gray-900 mb-4">Leave a comment</h4>
          <div class="grid md:grid-cols-2 gap-4 mb-4">
            <input type="text" placeholder="Your name" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <input type="email" placeholder="Your email" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          </div>
          <textarea placeholder="Write your comment..." rows="4" class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-4"></textarea>
          <button type="submit" class="px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition">
            Post Comment
          </button>
        </form>

        <!-- Comments List -->
        <div class="space-y-6">
          ${comments.map(comment => `
            <div class="flex gap-4">
              <img src="${comment.author.avatar}" alt="${comment.author.name}" class="w-10 h-10 rounded-full flex-shrink-0">
              <div class="flex-1">
                <div class="flex items-center gap-2 mb-1">
                  <span class="font-semibold text-gray-900">${comment.author.name}</span>
                  <span class="text-sm text-gray-500">${RustPress.helpers.formatDate(comment.createdAt, 'relative')}</span>
                </div>
                <p class="text-gray-700">${comment.content}</p>
                <div class="flex items-center gap-4 mt-2">
                  <button class="text-sm text-gray-500 hover:text-blue-600 transition flex items-center gap-1">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/></svg>
                    ${comment.likes}
                  </button>
                  <button class="text-sm text-gray-500 hover:text-blue-600 transition">Reply</button>
                </div>
                ${comment.replies?.length ? `
                  <div class="mt-4 ml-4 pl-4 border-l-2 border-gray-200 space-y-4">
                    ${comment.replies.map(reply => `
                      <div class="flex gap-3">
                        <img src="${reply.author.avatar}" alt="${reply.author.name}" class="w-8 h-8 rounded-full flex-shrink-0">
                        <div>
                          <div class="flex items-center gap-2 mb-1">
                            <span class="font-semibold text-gray-900 text-sm">${reply.author.name}</span>
                            <span class="text-xs text-gray-500">${RustPress.helpers.formatDate(reply.createdAt, 'relative')}</span>
                          </div>
                          <p class="text-gray-700 text-sm">${reply.content}</p>
                        </div>
                      </div>
                    `).join('')}
                  </div>
                ` : ''}
              </div>
            </div>
          `).join('')}
        </div>
      `;
    }

    function renderTableOfContents(post) {
      const content = post.html || post.content;
      const headings = content.match(/<h[23][^>]*>([^<]+)<\/h[23]>/gi) || [];
      const toc = headings.map((heading, i) => {
        const level = heading.match(/<h([23])/)[1];
        const text = heading.replace(/<[^>]+>/g, '');
        const id = 'heading-' + i;
        return { level, text, id };
      });

      document.getElementById('table-of-contents').innerHTML = toc.length ? toc.map(item => `
        <a href="#${item.id}" class="toc-link block text-sm ${item.level === '3' ? 'pl-4' : ''} text-gray-600 hover:text-blue-600 transition py-1">
          ${item.text}
        </a>
      `).join('') : '<p class="text-sm text-gray-500">No headings found</p>';
    }

    function renderSidebarAuthor(author) {
      document.getElementById('sidebar-author').innerHTML = `
        <div class="text-center">
          <img src="${author?.avatar}" alt="${author?.name}" class="w-16 h-16 rounded-full mx-auto mb-3">
          <h4 class="font-semibold text-gray-900">${author?.name}</h4>
          <p class="text-sm text-gray-500 mb-3">${author?.role || 'Author'}</p>
          <a href="${RustPress.helpers.getAuthorUrl(author)}" class="text-sm text-blue-600 hover:underline">View all posts</a>
        </div>
      `;
    }

    function renderPopularPosts(posts) {
      document.getElementById('popular-posts').innerHTML = posts.slice(0, 5).map((post, i) => `
        <a href="${RustPress.helpers.getPostUrl(post)}" class="flex gap-3 group">
          <span class="text-2xl font-bold text-gray-200 group-hover:text-blue-200 transition">${String(i + 1).padStart(2, '0')}</span>
          <div>
            <h4 class="text-sm font-medium text-gray-900 group-hover:text-blue-600 transition line-clamp-2">${post.title}</h4>
            <span class="text-xs text-gray-500">${post.views?.toLocaleString() || 0} views</span>
          </div>
        </a>
      `).join('');
    }

    function renderSidebarCategories(categories) {
      document.getElementById('sidebar-categories').innerHTML = categories.slice(0, 6).map(cat => `
        <a href="${RustPress.helpers.getCategoryUrl(cat)}" class="flex items-center justify-between text-sm text-gray-600 hover:text-blue-600 transition py-1">
          <span>${cat.name}</span>
          <span class="text-gray-400">${cat.count}</span>
        </a>
      `).join('');
    }

    function renderFooter(menus) {
      const footerMenu = menus.find(m => m.location === 'footer');
      if (footerMenu) {
        document.getElementById('footer-nav').innerHTML = footerMenu.items.map(item => `
          <a href="${item.url}" class="hover:text-white transition">${item.label}</a>
        `).join('');
      }
    }

    function setupScrollSpy() {
      // Add IDs to headings in content
      const content = document.getElementById('post-content');
      const headings = content.querySelectorAll('h2, h3');
      headings.forEach((heading, i) => {
        heading.id = 'heading-' + i;
      });
    }
  </script>
</body>
</html>
